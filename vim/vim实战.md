#  vim实战

## vim模式

Vim具有6种基本模式和5种派生模式。

* 普通模式(Normal mode)

    在普通模式中，用的编辑器命令，比如移动光标，删除文本等等。这也是Vim启动后的默认模式。
* 插入模式(Insert mode)

    在普通模式中，有很多方法可以进入插入模式。比较普通的方式是按a（append／追加）键或者i（insert／插入）键。在插入模式中，可以按ESC键回到普通模式。
* 可视模式(Visual mode)

    这个模式与普通模式比较相似。但是移动命令会扩大高亮的文本区域。高亮区域可以是字符、行或者是一块文本。当执行一个非移动命令时，命令会被执行到这块高亮的区域上。Vim的"文本对象"也能和移动命令一样用在这个模式中。
* 选择模式(Select mode)

    这个模式和无模式编辑器的行为比较相似（Windows标准文本控件的方式）。这个模式中，可以用鼠标或者光标键高亮选择文本，不过输入任何字符的话，Vim会用这个字符替换选择的高亮文本块，并且自动进入插入模式。
* 命令行模式(Command line mode)

    在命令行模式中可以输入会被解释成并执行的文本。例如执行命令（:键），搜索（/和?键）或者过滤命令（!键）。在命令执行之后，Vim返回到命令行模式之前的模式，通常是普通模式。
* Ex模式(Ex mode)

    这和命令行模式比较相似，在使用:visual命令离开Ex模式前，可以一次执行多条命令。

---

## vim指令及按键

### >进入vim

指令|含义
|:--|:--:|
vi filename    | 打开或新建文件，并将光标置于第一行首
vi +n filename |打开文件，并将光标置于第 n行首
vi + filename  |打开文件，并将光标置于最后一行首
vi -r filename |在上次正用 vi编辑时发生系统崩溃，恢复文件
vi file1....filen |  打开多个文件，依次编辑

### >移动光标

操作 | 含义
:--: | :--:
k、j、h、l|功能分别等同于上、下、左、右箭头键 
Ctrl+b|在文件中向上移动一页（相当于 PageUp 键）
Ctrl+f|在文件中向下移动一页（相当于 PageDown 键）
ctrl+u|屏幕往后移动半页
ctrl+d|屏幕往前移动半页
H     |将光标移到屏幕的最上行（Highest） 
nH    |将光标移到屏幕的第 n 行（如 2H： 将光标移到屏幕的第 2 行）
M     |将光标移到屏幕的中间（Middle）
L     |将光标移到屏幕的最下行（Lowest） 
nL    |将光标移到屏幕的倒数第 n 行（如 3L：将光标移到屏幕的倒数第 3 行）
w     |在指定行内右移光标，到下一个字的开头
e     |在指定行内右移光标，到一个字的末尾
b     |在指定行内左移光标，到前一个字的开头
0     |数字0，左移光标，到本行的开头 
G     |光标移动到文章的最后
nG    |光标移动到文章的第 n行（如8G：移动到文章的第 8行）
$     |右移光标，到本行的末尾 
^     |移动光标，到本行的第一个非空字符

### >替换和删除

操作 | 含义
:--:|:--:
c   |用 c 替换光标所指向的当前字符
nrc |用 c 替换光标所指向的前 n 个字符（如 5rc： 用 c 替换光标所指向的前 5 个字符）
x   |删除光标所在位置后面的一个字符 
nx  |删除光标所在位置后面的 n 个字符（如 3x：删除光标所在位置后面的 3 个字符）
X   |大写的 X，删除光标所在位置前面的一个字符
nX  |删除光标所在位置前面的 n 个字符（如 3X ： 删除光标所在位置前面的 3 个字符）
dd  |删除光标所在行，并去除空隙 
ndd |从光标所在行开始删除 n 行内容，并去除空隙（如 3dd： 删除 3 行内容，并去除空隙）

### >复制和粘贴

操作 | 含义
:--:|:--:
yy  |复制当前行到内存缓冲区
nyy |复制 n 行内容到内存缓冲区（如 5yy： 复制 5 行内容到内存缓冲区
p   |小写字母 p，将缓冲区的内容粘贴到光标的后面
P   |大写字母 P，将缓冲区的内容粘贴到光标的前面

### >搜索字符串

操作 | 含义
:--:|:--:
/str1 | 正向搜索字符串 str1 
n     | 继续搜索，找出 str1 字符串下次出现的位置 
?str2 | 反向搜索字符串 str2 

### >撤销和重复

操作 | 含义
:--:|:--:
u  |  撤消前一条命令的结果 
.  |  重复最后一条修改正文的命令 

### >文本选中

操作 | 含义
:--:|:--:
v  |  字符选中命令  
V  |  行选中命令

### >进入插入模式

操作 | 含义
:--:|:--:
i  |  在光标左侧输入正文
I  |  在光标所在行的开头输入正文 
a  |  在光标右侧输入正文
A  |  在光标所在行的末尾输入正文
o  |  在光标所在行的下一行增添新行 
O  |  在光标所在行的上一行增添新行

### >退出插入模式

`ESC`或`Ctrl+[` 

### >正文替换

操作 | 含义
:--:|:--:
:s/str1/str2/      |    用字符串 str2 替换行中首次出现的字符串 str1 
:s/str1/str2/g     |   用字符串 str2 替换行中所有出现的字符串 str1 
:.,$ s/str1/str2/g |  用字符串 str2 替换正文当前行到末尾所有出现的字符串 str1 
:1,$ s/str1/str2/g | 用字符串 str2 替换正文中所有出现的字符串 str1 
:g/str1/s//str2/g  |  功能同上
`:g` 放在命令末尾，表示对搜索字符串的每次出现进行替换；不加 g，表示只对搜索字符串的首次出现进行替换；g 放在命令开头，表示对正文中所有包含搜索字符串的行进行替换操作。

### >删除正文

操作 | 含义
:--:|:--:
:d      |                删除光标所在行 
:3d     |              删除第 3 行 
:.,$d   |              删除当前行至正文的末尾 
:/str1/,/str2/d  |   删除从字符串 str1 到 str2 的所有行 

### >退出命令

操作 | 含义
:--:|:--:
shift+zz | 保存并退出
:q       | 在未作修改的情况下退出
:q!      | 强制退出
:wq      | 保存并退出

---

## .vimrc文件

`~/.vimrc`文件包含了Vimscript代码，每次启动Vim时，Vim都会自动执行其中的代码。在任意系统中，在Vim中执行`:echo $MYVIMRC`命令可以快速得知这个文件的位置和名称。 文件的路径会在屏幕的底部显示。

---

## 打印信息

Vimscript中，我们最先关注的是echo和echom命令。可以在Vim中执行`:help echo`和`:help echom`命令以查看其帮助文档。当你写复杂的Vimscript时，你可能会想"打印一些信息"以方便调试程序。`:echo`命令会打印输出，但是一旦你的脚本运行完毕，那些输出信息就会消失。使用`:echom`打印的信息 会保存下来，你可以执行`:messages`命令再次查看那些信息。\

---

## 注释

在`.vimrc`文件中可以通过 <key>"<key> 字符添加注释。
> 练习：添加一行代码到你的~/.vimrc文件中，使得每个打开Vim时都会显示一个可爱的ASCII 字符猫(>^.^<)。

```bash
echo "(>^.^<)"
```
---

## 设置选项

Vim拥有很多选项可以设置以改变其展现方式。主要有两种选项：布尔选项（值为"on"或"off"）和键值选项。

### >布尔选项

例如：`set nu[mber]` `set nonu[mber]`，用来显示行号与取消显示。所有的布尔选项都是这种配置方法。`:set <name>`打开选项、`:set no<name>`关闭选项。

#### 切换布尔选项

你可以"切换"布尔选项的值，即从开启切为关闭或从关闭切为开启。执行命令：`:set <name>!`

#### 查看选项的当前值

你可以使用一个`?`符号向Vim获取一个选项的当前值。

### >键值选项

有些选项并不只有off或on两种状态，它们需要一个值。执行如下命令，查看返回结果：

```bash
:set number
:set numberwidth=10
:set numberwidth=4
:set numberwidth?
```

`numberwidth`选项改变行号的列宽。你可以通过`:set <name>=<value>`命令改变 非布尔选项的选项值，并使用`:set <name>?`命令查看选项的当前值。
可以使用`:set`一次性设置多个选项的值。

---

## 基本映射

你可以通过键盘映射告诉Vim：`当我按下这个键时，我需要你放弃默认操作，按我的想法做。`

### >normal模式的键盘映射

例如：`:map - x`就是将<key>-<key>映射为命令`x`，用来删除一个字符。

#### 特殊字符

可以使用`<keyname>`告诉Vim一个特殊的按键。

    :map <space> viw

移动光标到一个单词上，按下空格键。Vim将高亮选中整个单词。你也可以映射修饰键入Ctrl和Alt。执行：

    :map <c-d> dd

现在在键盘上按下<key>Ctrl+d<key>将执行`dd`命令。