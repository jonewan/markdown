# 计算机网络学习（一） — OSI模型及概述

## 一、计算机网络的分类

计算机网络根据其规模可以分为`WAN(Wide Area Network，广域网)`和`LAN（Local Area Network，局域网）`。

## 二、OSI七层模型

为了解决不同厂商生产的异构机型无法使用不同的协议互相通信的问题，ISO（International Organization for Standards，国际标准化组织）制定了OSI（Open System Interconnection，开放式通信系统参考模型）。在这一模型将通信协议中的必要功能分为七层，每个分层都接收由它下一层所提供的的特定的服务，并且负责为自己的上一层提供特定的服务。上下层之间进行交互时所遵循的约定叫做`接口`。同一层之间交互所遵循的约定叫做`协议`。

![分层模型](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B.png?raw=true)

OSI七层模型从上至下分为：

* 应用层：为应用程序提供服务并规定应用程序中通信的相关细节。包括文件传输、电子邮件、远程登录（虚拟终端）等协议。
* 表示层：将应用处理的信息转换为合适网络传输的格式，或将来自下一层的数据转换为上层能够处理的格式。具体来说就是将`某一台计算机或某一软件的特有数据格式`与`统一的网络数据格式`进行转换。
* 会话层：负责建立和断开通信连接，决定采用何种连接方法，以及建立连接和断开连接的时机。
* 传输层：在两个主机之间建立逻辑上的通信连接，为确保传输的数据到达目的地址，传输层会在通信两端的计算机之间进行确认，如果数据没有到达，它会负责重发。
* 网络层：该层主要负责寻址和路由选择。将数据传输到目标地址，目标地址可以是多个网络通过路由器连接而成的某一地址。
* 数据链路层：负责物理层面上的互联的、节点之间的传输。将比特序列划分为有意义的数据帧，进行数据帧的生成与接收。
* 物理层：负责比特流与电压高低、光的闪灭之间的互换。

![OSI七层模型](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/OSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B.png?raw=true)

每个分层上，在处理由上一层传过来的数据时需附加上当前分层的协议必须的`首部信息`，然后接收端对收到的数据进行`首部`与`数据`的分离，再转发给上一层，最终将发送端的数据恢复原样。

### 2.1 传输层与网络层的关系

在不同的网络体系结构中，网络层有时也不能保证数据的可达性，数据在传输过程中出现数据丢失、顺序混乱的问题的可能性会大大增加，在没有可靠性要求的网络层之上可以由传输层负责提供“正确传输数据的处理”。

### 2.2 数据链路层与网络层的关系

通信传输是通过物理介质实现的，数据链路层的作用就是在通过介质连接的设备间进行数据处理。网络层和数据链路层都是基于目标地址发送给接收端的，但是网络层负责将整个数据发送给最终目标地址，而数据链路层只负责发送一个分段内的数据。

### 2.3 物理层

物理层中，将数据的0、1转换为电压和脉冲信号给物理介质，通过介质实现设备间的传输。其采用MAC(Media Access Control，介质访问控制)地址识别连接到同一个传输介质上的设备。MAC地址由设备的制造厂商针对每块网卡（NIC，Network Interface Card）分别指定，通过制造商识别号、内部产品编号以及产品通用号保证MAC地址的唯一性。

## 三、面向有连接型与面向无连接型

通过网络发送数据可以分为面向有连接型与面向无连接型。

### 3.1 面向有连接型

在发送数据之前，需要在收发的主机之间连接一条通信线路，连接被关闭时无法发送数据。

![面向有连接型](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E9%9D%A2%E5%90%91%E6%9C%89%E8%BF%9E%E6%8E%A5%E5%9E%8B%E4%BC%A0%E8%BE%93.png?raw=true)

### 3.2 面向无连接型

无需确认对方是否存在，即不要求简历和断开连接，发送端可随时自由地发送数据。相对应的，接收端也永远不知道自己会什么时候从哪里接收到数据，因此在面向无连接的情况下，接收端需要时常确认是否收到了数据。

![面向无连接型](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E9%9D%A2%E5%90%91%E6%97%A0%E8%BF%9E%E6%8E%A5%E5%9E%8B%E4%BC%A0%E8%BE%93.png?raw=true)

## 四、电路交换与分组交换

网络通信的方式主要有两种，即`电路交换`和`分组交换`，电路交换技术主要用于过去的电话网，分组交换是一种较新的通信方式，TCP/IP就采用了分组交换技术。

在电路交换中，交换机主要负责中转处理，计算机连接在交换机上，而交换机与交换机之间继续连接，计算机在发送数据时需要通过交换机与目标主机建立通信电路，建立好连接后用户可以一直使用该条电路，直到该连接被断开。

![电路交换](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2.png?raw=true)

这就导致了一个问题，当一台计算机在收发信息时会独占整个电路，其他计算机智能干等着，因此无法实现多用户的同时通信，故出现了分组交换。

分组交换让连接到通信电路的计算机将要发送的数据分成多个数据包，按照一定顺序排列后分别发送，在分组的过程中，已经在每个分组的首部写入了发送端与接收端的地址，因此即使多用户同时通信也可以明确每个分组的目的地与源地址。

在分组交换中，由分组交换机（路由器）连接通信线路，其大致处理过程是：发送端计算机将数据分组发送给路由器，路由器接收到分组数据后缓存到自己的缓冲区，然后再转发给目标计算机。

![分组交换](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2.png?raw=true)

网络传输中，每个节点会根据分组数据的地址信息，来判断该报文应该由哪个网卡发送出去。为此，各个地址会参考一个发出接口列表。在这一点上MAC寻址与IP寻址是一样的。只不过MAC寻址中所参考的这张表叫做地址转发表，而IP寻址中所参考的叫做路由控制表。MAC地址转发表中所记录的是实际的MAC地址本身，而路由表中记录的IP地址则是集中了之后的网络号（确切的说，是网络号与子网掩码）。

![根据地址转发表与路由表定位报文发送的目标设备](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%9D%80%E8%BD%AC%E5%8F%91%E8%A1%A8%E4%B8%8E%E8%B7%AF%E7%94%B1%E8%A1%A8%E5%AE%9A%E4%BD%8D%E6%8A%A5%E6%96%87%E5%8F%91%E9%80%81%E7%9A%84%E7%9B%AE%E6%A0%87%E8%AE%BE%E5%A4%87.png?raw=true)

## 四、网络的构成要素

搭建一套网络环境要涉及各种各样的电缆和网络设备，连接计算机与计算机硬件的设备主要有：

设备    |   作用
:--:    |   :--:
网卡    |   使计算机联网的设备
中继器(Repeater)  |   从物理层上延长网络的设备
网桥(Bridge)/2层交换机  |   数据链路层上延长网络的设备
路由器(Router)/3层交换机   |   通过网络层转发分组数据的设备
4-7层交换机 |   处理传输层上个网络传输的设备
网关(Gateway)   |   转换协议的设备

### 4.1 通信媒介与数据链路

计算机之间通过线缆相互连接，包括双绞线、同轴电缆、光纤、串型电缆等。根据数据链路的不同，即相互直连的设备之间进行通信所涉及的协议及其网络不同选用不同的线缆类型，而媒介本身也有多种形态，比如电波、微波等不同的电磁波。

数据链路名  |   通信媒介    |   传输速率    |   主要用途
:-: | :-: | :-: | :-:
以太网  |   同轴电缆、双绞线、光纤  |   10Mbps、10Mbps-100Gbps、10Mbps-100Gbps  |   LAN
无线    |   电磁波  |   数个Mbps    |   LAN-WAN
ATM     |   双绞线、光纤    |   25Mbps、115Mbps、622Mbps    |   LAN-WAN
FDDI    |   双绞线、光纤    |   100Mbps    |   LAN-WAN
帧中继  |   双绞线、光纤    |   约64kbps \~ 1.5Mbps    |   WAN
ISDN  |   双绞线、光纤    |   64kbps \~ 1.5Mbps    |   WAN

#### 4.1.1 传输速率与吞吐量

在数据传输过程中，两个设备之间的数据流动的物理速度称为`传输速率`，用bps(bit per second)表示。严格来说电信号在各个媒介中传输的速率是一定的（$3\times10^8$ m/s），因此传输速率主要由线缆的根数决定，传输速率又称作`带宽(Bandwith)`，带宽越大传输能力越强。主机之间的传输速率又称作`吞吐量`。

### 4.2 网卡

任何一台计算机连接网络时必须使用网卡（NIC），有时也叫`网络适配器`、`LAN卡`，没有网卡的设备无法连接网络。

### 4.3 中继器

中继器（Repeater）是物理层上延长网络的设备，由电缆传过来的电信号或光信号经由中继器的波形调整和放大再传给另一个电缆。中继器是对衰弱信号进行放大和发送的设备，即使在数据链路层出现某些错误，中继器仍然转发数据，中继器无法改变传输速度，因此不能在传输速度不同的媒介之间进行转发（比如中继器无法连接一个100Mbps的以太网和另一个10Mbps的以太网）。

有些中继器可以提供多端口服务，被称作`中继集线器`或`集线器`。

![中继](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E4%B8%AD%E7%BB%A7.png?raw=true)

### 4.4 网桥/2层交换机

网桥是在`数据链路层`上连接两个网络的设备，它能够识别数据链路层中的数据帧，并将这些数据帧临时存储于内存，再重新生成一个信号作为一个全新的帧转发给相连的另一个网段，由于具有存储特性，网桥可以连接两个速度不相同的数据链路，并且不限制连接网段的个数。

数据链路的数据帧中有一个`FCS数据位`，用来校验数据是否正确送达目的地址，网桥通过检查该值将那些损坏的数据丢弃，避免转发给其他网段。网桥还可以通过`自学机制`和`过滤功能`控制网络流量。

这里所说的地址是指MAC地址、硬件地址、物理地址以及适配器地址，也就是网络上针对网卡（NIC）分配的地址。由于是OSI模型第二层的功能，故网桥也称为2层交换机（L2交换机）。

![网桥](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E7%BD%91%E6%A1%A5_2%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA.png?raw=true)

### 4.5 路由器/3层交换机

路由器是在网络层上连接两个网络，并将分组报文转发给另一个目标路由器的设备，其与网桥不同的是，网桥根据MAC地址进行处理，而路由器使用IP地址进行处理。路由器可以连接不同的数据链路，比如以太网和FDDI。由于其在OSI模型第三层，故也称为3层交换机（L3交换机）。

![路由器](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E8%B7%AF%E7%94%B1%E5%99%A8_3%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA.png?raw=true)

### 4.6 4-7层交换机

4-7层交换机负责处理传输层至应用层的数据，在实际通信中，当网络比较拥堵的时候，需要通过`带宽控制`优先处理语音这类实时性要求较高的通信请求，放缓邮件或数据转发等实时性要求不高的请求，带宽控制是4-7层交换机的重要功能之一。

### 4.7 网关

网关负责协议的转换与数据的转发，也是处理传输层到应用层的数据，与4-7层交换机不同的是，网关不仅转发数据，还会对数据的协议进行翻译和转换，例如互联网邮件与手机邮件协议的转换。在使用万维网（www）时为了控制网络流量以及安全性考虑，有时会使用代理服务器，这种称为`应用网关`。防火墙就是一种通过网关通信，针对不同应用提高安全性的产品。

![网关/4-7层交换机](https://github.com/jonewan/markdown/blob/master/TCP_IP/Insert_picture/%E7%BD%91%E5%85%B3_4-7%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA.png?raw=true)

## 五、单播、广播、多播、任播

在网络通信中，可以依据目标地址的个数及其后续的行为对通信分为`单播`、`广播`、`多播`、`任播`。

* 单播（Unicast）：指的是一对一的通信
* 广播（Broadcast）：一对多的通信，典型的例子就是电视播放，其将电视信号一齐发送给非特定的多个接收对象，进行广播的计算机有其广播范围，称之为`广播域`。
* 多播/组播（Multicast）：组播与广播类似，也是一对多的通信，不同之处在于组播要限定某一组主机作为接收端，典型的例子是视频会议。
* 任播（Anycast）：在多台特定的主机中选出一台主机作为接收端，通常被选中的特定主机返回一个单播信号，随后发送端只与该特定主机通信。

