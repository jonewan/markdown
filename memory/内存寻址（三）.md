# 内存寻址（三）

## 物理内存布局

在初始化阶段，内核必须建立一个物理地址映射来指定哪些物理地址对内核可用，而哪些不可用（由于部分物理地址映射硬件设备的I/O共享内存，或者相应的页框含有BIOS数据）

内核将下列页框标记为`保留页框`：

* 不可用物理地址范围内的页框
* 含有内核代码和已初始化数据结构的页框

保留页框中的页（数据）绝对不能动态分配或者交换到磁盘上。

## 内核为什么没有安装在内存（DRAM）的第一个MB开始的地方

* 页框0由BIOS使用，存放上电自检（Power-On Self-Test， POST）期间检查到的系统配置，许多机器的BIOS甚至在系统初始化后还需将数据写在页框0中。
* 物理地址从0x000a0000到0x000fffff的范围通常留给BIOS例程，并且映射ISA图形卡上的内部内存。
* 第一个MB的其他页框可能由特定计算机模型保留。

为了避免把内核装进一组不连续的页框中，Linux更愿意跳过RAM的第一个MB，其使用PC结构未保留的页框来存放所分配的页。

## 进程页表

进程的线性地址空间（虚拟地址空间0~4G）分为两部分：

* 从0G（0x00000000）到3G-1（0xbfffffff）的线性地址，作为用户空间，用户态进程与内核态进程都可访问。
* 从3G（0xC0000000）到4G-1（0xffffffff）的线性地址，作为内核空间，仅支持内核态进程访问。

当进程运行在用户态时，其产生的线性地址小于3G，当进程运行在内核态时其执行内核代码，产生的线性地址大于3G。某些情况下，内核为了检索或者存放数据必须访问用户空间。宏`PAGE_OFFSET`产生的值为0xc0000000(3G)。

## 内核页表

内核维持着一组自己使用的页表，驻留在`主内核页全局目录（master kernel Page Global Directory）`中。

